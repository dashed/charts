{{ if or .Values.plex.enabled .Values.plexpia.enabled .Values.plexgluetun.enabled }}
apiVersion: v1
kind: ConfigMap
metadata:
  name: plex-config
data:
  # PLEX_PREFERENCE_1: "FriendlyName=ElfHosted | {{ .Release.Name }}"
  PLEX_PREFERENCE_2: "FSEventLibraryPartialScanEnabled=1"
  PLEX_PREFERENCE_3: "FSEventLibraryUpdatesEnabled=1"
  PLEX_PREFERENCE_4: "TranscoderPhotoFileSizeLimitMiB=5"
  PLEX_PREFERENCE_5: "ScannerLowPriority=1"
  PLEX_PREFERENCE_6: "TranscodeCountLimit=3"
  # PLEX_PREFERENCE_7: "TranscoderQuality=1" # we have transcode-killer now, so no need to force low quality
  PLEX_PREFERENCE_8: "BackgroundTranscodeLowPriority=1"
  PLEX_PREFERENCE_9: "LongRunningJobThreads=1"
  PLEX_PREFERENCE_10: "TranscoderH264BackgroundPreset=ultrafast"
  PLEX_PREFERENCE_11: "RelayEnabled=0"
  PLEX_PREFERENCE_12: "TranscoderTempDirectory=/transcode"
  PLEX_PREFERENCE_13: "MinutesAllowedPaused=30"
  PLEX_PREFERENCE_14: "GenerateIntroMarkerBehavior=scheduled"
  PLEX_PREFERENCE_15: "ButlerStartHour=5"
  PLEX_PREFERENCE_16: "ButlerEndHour=6"
  PLEX_PREFERENCE_17: "ButlerTaskDeepMediaAnalysis=0" # this wrecks remote mounts
  PLEX_PREFERENCE_18: "ButlerTaskUpgradeMediaAnalysis=0" # suspect this does too
  
  # For custom domains
  {{- if .Values.plexcustomdomain.enabled }}
  ADVERTISE_IP: "https://{{ .Values.plexcustomdomain.cname }}:443"
  {{ else }}
  ADVERTISE_IP: "https://{{ .Release.Name }}-plex.elfhosted.com:443"
  {{ end }}

  # to ensure VPN is up first
  WAIT_FOR_VPN: "true"
{{ end }}